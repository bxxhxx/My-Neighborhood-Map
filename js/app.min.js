var ViewModel=function(){var e=this;this.Star=function(e){this.fullName=ko.observable(e.fullName),this.category=ko.observable(e.category),this.address=e.address,this.chosen=!1,this.order=-1,this.show=ko.observable(!1),this.marker=null,this.categoryVisible=ko.observable(!1),this.multiple=e.multiple},this.walkOfFameList=ko.observableArray([]),this.query=ko.observable(""),this.currentCategory=ko.observable(""),this.currentStar=ko.observable(null),this.newOrder=0,this.topOrder=0,this.rangeStart=0,this.infowindow=new google.maps.InfoWindow,this.category=ko.observableArray(["Live performance","Motion pictures","Radio","Recording","Television"]),completeStarDataModel.forEach(function(r){for(var a=r.fullName,t=function(e){return e.category.length>1?!0:!1},o=t(r),n=0;n<r.category.length;n++){var i=r.category[n],s=r.address[n],l={fullName:a,category:i,address:s,multiple:o};e.walkOfFameList.push(new e.Star(l))}}),this.showRangeEvaluator=function(r){if(r.order>=e.rangeStart&&r.order<e.rangeStart+20){r.show(!0);var a=function(r){""===e.currentCategory()&&r.multiple===!0?r.categoryVisible(!0):r.categoryVisible(!1)};a(r),e.starSetter(r)}else e.starClear(r)},this.starClear=function(e){null!==e.marker&&e.marker.setMap(null),e.show(!1)},this.search=function(r){e.currentCategory(""),e.newOrder=0,e.topOrder=0,e.rangeStart=0,e.walkOfFameList().forEach(function(a){r===!1||null===r?(a.order=-1,a.chosen=!1,e.starClear(a)):a.fullName().toLowerCase().indexOf(r.toLowerCase())>=0?(a.chosen=!0,a.order=e.newOrder,e.topOrder=e.newOrder,e.showRangeEvaluator(a),e.newOrder++):(a.order=-1,a.chosen=!1,e.starClear(a))})},e.query.subscribe(e.search),this.clearButton=function(){e.currentCategory(""),e.query(null),e.rangeStart=0,e.newOrder=0,e.topOrder=0,e.walkOfFameList().forEach(function(r){e.starClear(r)})},this.starSetter=function(r){var a,t=window.innerWidth;if(a=701>t?"image/mobilstar.png":"image/smallstar.png",null===r.marker){r.marker=new google.maps.Marker({map:map,animation:google.maps.Animation.DROP,position:null,icon:a});var o=r.address+",+Los+Angeles,+CA";$.getJSON("https://maps.googleapis.com/maps/api/geocode/json?address="+o+",+Los+Angeles,+CA",null,function(a,t){if("OK"==a.status){var o=a.results[0].geometry.location;r.marker.setPosition(o),r.marker.addListener("click",function(){e.chooseStar(r)}),r.show()===!0&&r.marker.setMap(map)}})}else r.marker.setMap(map)},this.chooseStar=function(r){var a,t=window.innerWidth;a=701>t?"image/mobilstar.png":"image/smallstar.png",e.currentStar()&&(e.currentStar().marker.setAnimation(null),e.currentStar().marker.setIcon(a)),e.currentStar(r);var o;o=701>t?"image/mobilstarActivated.png":"image/smallstarActivated.png",r.marker.setIcon(o),e.infoActivate(e.currentStar())},this.toggleBounce=function(e){null!==e.marker.getAnimation()?e.marker.setAnimation(null):e.marker.setAnimation(google.maps.Animation.BOUNCE)},this.infoActivate=function(r){var a="",t="https://en.wikipedia.org/w/api.php",o=r.fullName(),n=r.address;$.ajax({url:t,data:{action:"opensearch",search:o,format:"json",limit:1,namespace:0},dataType:"jsonp"}).done(function(t){a=t[3][0];var i='<div class="infoWindow"><p>'+o+"</p><p>"+n+'</p><p><a target="_blank" href="'+a+'">Read more at Wikipedia</a></p></div>';e.infowindow.setContent(i),e.infowindow.open(map,r.marker),e.toggleBounce(r)}).fail(function(){var a='<div class="infoWindow"><p>'+o+"</p><p>"+n+'</p><p class="error">Wikipedia link unavailable - please try again later!</p></div>';e.infowindow.setContent(a),e.infowindow.open(map,r.marker),e.toggleBounce(r)})},this.categorySelector=function(r){e.clearButton(),e.currentCategory(r),e.walkOfFameList().forEach(function(a){r===a.category()?(a.chosen=!0,a.order=e.newOrder,e.topOrder=e.newOrder,e.showRangeEvaluator(a),e.newOrder++):(a.order=-1,a.chosen=!1,e.starClear(a))})},this.nextRange=function(){var r=e.rangeStart+20;r<e.topOrder&&(e.rangeStart=r,e.walkOfFameList().forEach(function(r){e.showRangeEvaluator(r)}))},this.previousRange=function(){var r=e.rangeStart-20;r>=0&&(e.rangeStart=r,e.walkOfFameList().forEach(function(r){e.showRangeEvaluator(r)}))},e.query("Charlie Chaplin")};init();