"use strict";var ViewModel=function(){var e=this;this.startMap=function(){var e=window.innerWidth,r=15,i=34.1,t=-118.332;if(window.innerHeight>window.innerWidth&&window.innerWidth<701||window.innerHeight<window.innerWidth&&window.innerWidth<851)r=14;else{var a=100-e/1300*100,o=21604e-8*a;t+=o,1e3>e&&(r=14)}window.map=new google.maps.Map(document.getElementById("map"),{center:{lat:i,lng:t},zoom:r,zoomControl:!0,zoomControlOptions:{position:google.maps.ControlPosition.LEFT_BOTTOM},streetViewControl:!1,mapTypeControl:!1})},this.dataRequest=function(){e.startMap();var r=setTimeout(function(){e.errorVisibility(!0),e.errorMessage("Error: Wikipedia request timeout!")},8e3);$.ajax({url:"https://en.wikipedia.org/w/api.php",data:{action:"query",prop:"revisions",format:"json",rvprop:"content",pageids:"1310953"},dataType:"jsonp"}).done(function(i){clearTimeout(r);var t=i.query.pages[1310953].revisions[0]["*"];sortTheData(t),e.walkOfFameListMaker(),$(".listContainerBlock__list").removeClass("hideFirst"),e.query("Charlie Chaplin")}).fail(function(){clearTimeout(r),e.errorVisibility(!0),e.errorMessage("Error: Wikipedia request failure!")})},this.Star=function(e){this.fullName=ko.observable(e.fullName),this.category=ko.observable(e.category),this.address=e.address,this.chosen=!1,this.order=-1,this.show=ko.observable(!1),this.marker=new google.maps.Marker({map:map,animation:google.maps.Animation.DROP,position:null,icon:null,visible:!1}),this.categoryVisible=ko.observable(!1),this.multiple=e.multiple},this.errorVisibility=ko.observable(!1),this.errorMessage=ko.observable(""),this.walkOfFameList=ko.observableArray([]).extend({rateLimit:{method:"notifyWhenChangesStop",timeout:100}}),this.query=ko.observable(""),this.currentCategory=ko.observable(""),this.currentStar=ko.observable(null),this.resizeMobileCalculator=function(){var e=window.innerHeight,r=window.innerWidth;return e>r&&701>r||r>e&&851>r?!0:!1};var r=$(window);r.resize(function(){e.isMobile(e.resizeMobileCalculator()),e.range=function(){return e.isMobile()===!0?5:15}(),e.walkOfFameList().forEach(function(r){var i;i=e.isMobile()===!0?"image/mobilstar.png":"image/smallstar.png",null!==r.marker&&(r.marker.setIcon(i),e.showRangeEvaluator(r))});var r=window.innerWidth,i=15,t=34.1,a=-118.332;if(e.isMobile()===!0)i=14;else{var o=100-r/1300*100,n=21604e-8*o;a+=n,1e3>r&&(i=14)}map.setCenter({lat:t,lng:a})}),this.isMobile=ko.observable(function(){return window.innerHeight>window.innerWidth&&window.innerWidth<701||window.innerHeight<window.innerWidth&&window.innerWidth<851?!0:!1}()),this.newOrder=0,this.topOrder=0,this.rangeStart=0,this.range=function(){return e.isMobile()===!0?5:15}(),this.infowindow=new google.maps.InfoWindow,this.category=ko.observableArray(["Live performance","Motion pictures","Radio","Recording","Television"]),this.walkOfFameListMaker=function(){completeStarDataModel.forEach(function(r){for(var i=r.fullName,t=function(e){return e.category.length>1?!0:!1},a=t(r),o=0;o<r.category.length;o++){var n=r.category[o],s=r.address[o],l={fullName:i,category:n,address:s,multiple:a};e.walkOfFameList.push(new e.Star(l))}})},this.showRangeEvaluator=function(r){if(r.order>=e.rangeStart&&r.order<e.rangeStart+e.range){r.show(!0);var i=function(r){""===e.currentCategory()&&r.multiple===!0?r.categoryVisible(!0):r.categoryVisible(!1)};i(r),e.starSetter(r)}else e.starClear(r)},this.starClear=function(r){e.infowindow.close(),null!==r.marker&&r.marker.setVisible(!1),r.show(!1)},this.search=function(r){e.currentCategory(""),e.newOrder=0,e.topOrder=0,e.rangeStart=0,e.walkOfFameList().forEach(function(i){r===!1||null===r?(i.order=-1,i.chosen=!1,e.starClear(i)):i.fullName().toLowerCase().indexOf(r.toLowerCase())>=0?(i.chosen=!0,i.order=e.newOrder,e.topOrder=e.newOrder,e.showRangeEvaluator(i),e.newOrder++):(i.order=-1,i.chosen=!1,e.starClear(i))})},e.query.subscribe(e.search),this.clearButton=function(){e.currentCategory(""),e.query(null),e.rangeStart=0,e.newOrder=0,e.topOrder=0,e.walkOfFameList().forEach(function(r){e.starClear(r)})},this.starSetter=function(r){if(null===r.marker.getPosition()){var i=r.address+",+Los+Angeles,+CA",t=setTimeout(function(){e.errorVisibility(!0),e.errorMessage("Error: geocode request timeout! Markers Unavailable!")},8e3);$.getJSON("https://maps.googleapis.com/maps/api/geocode/json?address="+i+",+Los+Angeles,+CA",null,function(i,a){if(clearTimeout(t),"OK"==i.status){var o=i.results[0].geometry.location;if(r.marker.setPosition(o),r.marker.addListener("click",function(){e.chooseStar(r)}),r.show()===!0){var n;n=e.isMobile()===!0?"image/mobilstar.png":"image/smallstar.png",r.marker.setIcon(n),r.marker.setVisible(!0)}}else"OVER_QUERY_LIMIT"===i.status?r.show()===!0&&e.starSetter(r):(e.errorVisibility(!0),e.errorMessage("Error: Geocode -  Message: "+i.status+"</p>"))})}else{var a;a=e.isMobile()===!0?"image/mobilstar.png":"image/smallstar.png",r.marker.setIcon(a),r.marker.setVisible(!0)}},this.chooseStar=function(r){var i;i=e.isMobile()===!0?"image/mobilstar.png":"image/smallstar.png",e.currentStar()&&(e.currentStar().marker.setAnimation(null),e.currentStar().marker.setIcon(i)),e.currentStar(r);var t;t=e.isMobile()===!0?"image/mobilstarActivated.png":"image/smallstarActivated.png",r.marker.setIcon(t),e.infoActivate(e.currentStar())},this.toggleBounce=function(e){null!==e.marker.getAnimation()?e.marker.setAnimation(null):e.marker.setAnimation(google.maps.Animation.BOUNCE)},this.infoActivate=function(r){var i="",t="https://en.wikipedia.org/w/api.php",a=r.fullName(),o=r.address,n=setTimeout(function(){var i='<div class="infoWindow"><p>'+a+"</p><p>"+o+'</p><p class="error">Wikipedia link unavailable - please try again later!</p></div>';e.infowindow.setContent(i),e.infowindow.open(map,r.marker),e.toggleBounce(r)},8e3);$.ajax({url:t,data:{action:"opensearch",search:a,format:"json",limit:1,namespace:0},dataType:"jsonp"}).done(function(t){i=t[3][0];var s='<div class="infoWindow"><p>'+a+"</p><p>"+o+'</p><p><a target="_blank" href="'+i+'">Read more at Wikipedia</a></p></div>';e.infowindow.setContent(s),e.infowindow.open(map,r.marker),e.toggleBounce(r),clearTimeout(n)}).fail(function(){var i='<div class="infoWindow"><p>'+a+"</p><p>"+o+'</p><p class="error">Wikipedia link unavailable - please try again later!</p></div>';e.infowindow.setContent(i),e.infowindow.open(map,r.marker),e.toggleBounce(r),clearTimeout(n)})},this.categorySelector=function(r){e.clearButton(),e.currentCategory(r),e.walkOfFameList().forEach(function(i){r===i.category()?(i.chosen=!0,i.order=e.newOrder,e.topOrder=e.newOrder,e.showRangeEvaluator(i),e.newOrder++):(i.order=-1,i.chosen=!1,e.starClear(i))})},this.nextRange=function(){var r=e.rangeStart+e.range;r<e.topOrder&&(e.rangeStart=r,e.walkOfFameList().forEach(function(r){e.showRangeEvaluator(r)}))},this.previousRange=function(){var r=e.rangeStart-e.range;r>=0&&(e.rangeStart=r,e.walkOfFameList().forEach(function(r){e.showRangeEvaluator(r)}))},e.dataRequest()},initMap=function(){ko.applyBindings(new ViewModel)};